services:
  baseimage:
    build:
      context: ../..
      dockerfile: Sources/docker/Dockerfile.baseImage
    image: baseimage:latest

  fsgfuzz:
    build:
      context: ../..
      dockerfile: Sources/docker/Dockerfile.fsgfuzz
    depends_on:
      - baseimage
    container_name: fsgfuzz
    privileged: true
    volumes:
      - ../../fuzz_output:/workspace/sgfuzz-for-fprime/fuzz_output  # 퍼징 결과만 저장
    environment:
      - COMPONENT_NAME=CmdDispatcher      # 타겟 컴포넌트 이름
      - FUZZ_RUNS=-1                      # 실행 횟수 (-1=무한)
      - FUZZ_MAX_LEN=1024                 # 최대 입력 크기
      - FUZZ_TIMEOUT=60                   # 타임아웃(초)
      - FUZZ_WORKERS=1                    # 병렬 워커 수
      - KEEP_ALIVE=false                  # 퍼징 후 컨테이너 유지 여부
    tty: true
    stdin_open: true
